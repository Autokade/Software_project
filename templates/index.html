{% extends "base.html" %}
{% block title %}Home - Creative Registry{% endblock %}
{% block content %}

<h2>ğŸ“š Registered Creative Works</h2>

{% if works %}
<div style="margin-top:15px;">
    <table style="width:100%; border-collapse:collapse; background:#fff;">
        <tr style="background:#f0f0f0; font-weight:bold;">
            <th style="padding:10px;">Title</th>
            <th>Uploaded By</th>
            <th>Type</th>
            <th>Uploaded At</th>
            <th>Action</th>
        </tr>

        {% for w in works %}
        <tr style="text-align:center; border-bottom:1px solid #eee;">
            <td style="padding:10px;">{{ w.title }}</td>
            <td>{{ w.uploaded_by }}</td>
            <td>{{ w.work_type }}</td>
            <td>{{ w.uploaded_at[:10] }}</td>
            <td>
                <a href="{{ url_for('work_detail', work_id=w.id) }}">View</a> |
                <a href="{{ url_for('download_work', work_id=w.id) }}">Download</a>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>
{% else %}
<p>No works uploaded yet. Upload your first file!</p>
{% endif %}

<hr style="margin:30px 0; border:2px solid #eee;">

<!-- ================= QUICK PLAGIARISM SCAN ================= -->
<h2>ğŸ•µï¸ Quick Plagiarism Check</h2>
<p>Upload a PDF to compare similarity against registered works</p>

<form method="POST" action="{{ url_for('plagiarism') }}" enctype="multipart/form-data" style="margin-top:10px;">
    <input type="file" name="file" accept=".pdf" required>
    <button type="submit" style="margin-left:10px;">Check Plagiarism</button>
</form>

<!-- =============== SHOW PLAGIARISM RESULTS HISTORY =============== -->
{% if plagiarism_reports %}
<div style="margin-top:40px;">
    <h2>ğŸ“Š Recent Plagiarism Scans</h2>

    <table style="width:100%; border-collapse:collapse; background:#fff; margin-top:10px;">
        <tr style="background:#e9e9e9; font-weight:bold;">
            <th style="padding:10px;">File Name</th>
            <th>Checked By</th>
            <th>Timestamp</th>
            <th>Matches</th>
        </tr>

        {% for report in plagiarism_reports %}
        <tr style="text-align:center; border-bottom:1px solid #ddd;">
            <td style="padding:10px;">{{ report.filename }}</td>
            <td>{{ report.checked_by }}</td>
            <td>{{ report.timestamp[:10] }}</td>
            <td>
                {% if report.matches %}
                    <details>
                        <summary style="cursor:pointer; color:#667eea; font-weight:bold;">
                            {{ report.matches|length }} match(es)
                        </summary>
                        <div style="padding:10px; text-align:left;">
                            {% for m in report.matches %}
                            <div style="padding:8px; border-bottom:1px solid #eee;">
                                <strong>{{ m.title }}</strong>
                                <br><span style="font-size:0.9em;">By {{ m.uploaded_by }}</span>
                                <br>

                                {% if m.similarity_pct > 90 %}
                                    <span style="color:#ff3333; font-weight:bold;">ğŸ”´ {{ m.similarity_pct }}% Match</span>
                                {% elif m.similarity_pct > 70 %}
                                    <span style="color:#ff8800; font-weight:bold;">ğŸŸ  {{ m.similarity_pct }}% Similar</span>
                                {% elif m.similarity_pct > 40 %}
                                    <span style="color:#c4a200; font-weight:bold;">ğŸŸ¡ {{ m.similarity_pct }}% Similar</span>
                                {% else %}
                                    <span style="color:#2c9d44; font-weight:bold;">ğŸŸ¢ {{ m.similarity_pct }}% Low match</span>
                                {% endif %}

                                <br><small>Distance: {{ m.hamming_distance }}</small>
                                <br>
                                
                                <!-- Action Buttons -->
                                <a href="{{ url_for('work_detail', work_id=m.work_id) }}">View Work</a> |
                                <a href="{{ url_for('download_work', work_id=m.work_id) }}">ğŸ“¥ Download</a>
                            </div>
                            {% endfor %}
                        </div>
                    </details>
                {% else %}
                    <span style="color:green;">No matches ğŸ‰</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>
</div>
{% endif %}

{% endblock %}
